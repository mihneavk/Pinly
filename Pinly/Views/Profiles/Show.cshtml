@model Pinly.ViewModels.ProfileViewModel

@{
    ViewData["Title"] = "Profil - " + Model.User.UserName;
}

<style>
    .masonry-grid {
        column-count: 4;
        column-gap: 1.5rem;
    }

    .masonry-item {
        display: inline-block;
        width: 100%;
        margin-bottom: 1.5rem;
        break-inside: avoid;
    }

    @@media (max-width: 992px) {
        .masonry-grid {
            column-count: 3;
        }
    }

    @@media (max-width: 768px) {
        .masonry-grid {
            column-count: 2;
        }
    }

    @@media (max-width: 576px) {
        .masonry-grid {
            column-count: 1;
        }
    }

    .pin-card:hover {
        transform: scale(1.02);
        transition: 0.3s;
        cursor: pointer;
    }

    .profile-avatar-container {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto;
        border-radius: 50%;
        overflow: hidden;
    }

    .avatar-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.2s;
        cursor: pointer;
    }

    .profile-avatar-container:hover .avatar-overlay {
        opacity: 1;
    }
</style>

<div class="container mt-5">
    <div class="text-center mb-5">
        @{
            // AICI FOLOSIM DOAR USERNAME
            var displayName = Model.User.UserName ?? "Anonim";
            var initial = (!string.IsNullOrEmpty(displayName)) ? displayName.Substring(0, 1).ToUpper() : "U";
        }

        @if (Model.IsOwner)
        {
            <form asp-action="UpdateProfilePicture" asp-controller="Profiles" method="post" enctype="multipart/form-data" id="avatarForm">
                <input type="file" name="profilePicture" id="fileInput" style="display:none" onchange="document.getElementById('avatarForm').submit()" accept="image/*" />
            </form>
        }

        <div class="profile-avatar-container bg-secondary text-white d-flex align-items-center justify-content-center shadow"
             onclick="@(Model.IsOwner ? "document.getElementById('fileInput').click()" : "")">

            @if (!string.IsNullOrEmpty(Model.User.ProfilePicturePath))
            {
                <img src="@Model.User.ProfilePicturePath" style="width:100%; height:100%; object-fit:cover;" />
            }
            else
            {
                <span style="font-size: 3rem; font-weight: bold;">@initial</span>
            }

            @if (Model.IsOwner)
            {
                <div class="avatar-overlay">
                    <i class="bi bi-camera-fill text-white fs-3"></i>
                </div>
            }
        </div>

        <h2 class="fw-bold mt-3">@displayName</h2>

        <div class="mt-3">
            @if (Model.IsOwner)
            {
                <a asp-area="Identity" asp-page="/Account/Manage/Index" class="btn btn-light rounded-pill px-4 fw-bold">Editeaza cont</a>
            }
            else
            {
                <button class="btn btn-danger rounded-pill px-4 fw-bold">Follow</button>
            }
        </div>
    </div>

    <div class="mt-4">
        <h4 class="fw-bold text-center mb-4">Pin-uri create</h4>
        @if (!Model.Pins.Any())
        {
            <div class="text-center text-muted py-5"><h5>Nu exista pin-uri.</h5></div>
        }
        else
        {
            <div class="masonry-grid">
                @foreach (var pin in Model.Pins)
                {
                    <div class="card masonry-item border-0 shadow-sm pin-card">
                        <a asp-controller="Pins" asp-action="Show" asp-route-id="@pin.Id">
                            <img src="@pin.MediaPath" class="card-img-top rounded-3" style="width: 100%; display: block;">
                        </a>
                    </div>
                }
            </div>
        }
    </div>
</div>